BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

IF (OBJECT_ID(N'[SampleClass1]', N'U') IS NOT NULL)
	DROP TABLE [SampleClass1]

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

IF (OBJECT_ID(N'[SampleClass1]', N'U') IS NULL)
	CREATE TABLE [SampleClass1]
	(
		[Id]    Int NOT NULL,
		[Value] Int NOT NULL
	)

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

INSERT INTO [SampleClass1]
(
	[Id],
	[Value]
)
SELECT 1,1000 UNION ALL
SELECT 2,2000 UNION ALL
SELECT 3,3000 UNION ALL
SELECT 4,4000 UNION ALL
SELECT 5,5000 UNION ALL
SELECT 6,6000 UNION ALL
SELECT 7,7000 UNION ALL
SELECT 8,8000 UNION ALL
SELECT 9,9000 UNION ALL
SELECT 10,10000

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

IF (OBJECT_ID(N'[SampleClass2]', N'U') IS NOT NULL)
	DROP TABLE [SampleClass2]

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

IF (OBJECT_ID(N'[SampleClass2]', N'U') IS NULL)
	CREATE TABLE [SampleClass2]
	(
		[Id]    Int NOT NULL,
		[Value] Int NOT NULL
	)

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

INSERT INTO [SampleClass2]
(
	[Id],
	[Value]
)
SELECT 1,1000 UNION ALL
SELECT 2,2000 UNION ALL
SELECT 3,3000 UNION ALL
SELECT 4,4000 UNION ALL
SELECT 5,5000 UNION ALL
SELECT 6,6000 UNION ALL
SELECT 7,7000 UNION ALL
SELECT 8,8000 UNION ALL
SELECT 9,9000 UNION ALL
SELECT 10,10000

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

IF (OBJECT_ID(N'[ChildEntitity]', N'U') IS NOT NULL)
	DROP TABLE [ChildEntitity]

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

IF (OBJECT_ID(N'[ChildEntitity]', N'U') IS NULL)
	CREATE TABLE [ChildEntitity]
	(
		[Id]       Int NOT NULL,
		[ParentId] Int     NULL,
		[SubId]    Int NOT NULL
	)

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

INSERT INTO [ChildEntitity]
(
	[Id],
	[ParentId],
	[SubId]
)
SELECT 1,1,1 UNION ALL
SELECT 2,1,2 UNION ALL
SELECT 3,1,3 UNION ALL
SELECT 4,1,4 UNION ALL
SELECT 5,1,5 UNION ALL
SELECT 6,1,6 UNION ALL
SELECT 7,1,7 UNION ALL
SELECT 8,1,8 UNION ALL
SELECT 9,1,9 UNION ALL
SELECT 10,1,10 UNION ALL
SELECT 11,2,11 UNION ALL
SELECT 12,2,12 UNION ALL
SELECT 13,2,13 UNION ALL
SELECT 14,2,14 UNION ALL
SELECT 15,2,15 UNION ALL
SELECT 16,2,16 UNION ALL
SELECT 17,2,17 UNION ALL
SELECT 18,2,18 UNION ALL
SELECT 19,2,19 UNION ALL
SELECT 20,2,20 UNION ALL
SELECT 21,3,21 UNION ALL
SELECT 22,3,22 UNION ALL
SELECT 23,3,23 UNION ALL
SELECT 24,3,24 UNION ALL
SELECT 25,3,25 UNION ALL
SELECT 26,3,26 UNION ALL
SELECT 27,3,27 UNION ALL
SELECT 28,3,28 UNION ALL
SELECT 29,3,29 UNION ALL
SELECT 30,3,30 UNION ALL
SELECT 31,4,31 UNION ALL
SELECT 32,4,32 UNION ALL
SELECT 33,4,33 UNION ALL
SELECT 34,4,34 UNION ALL
SELECT 35,4,35 UNION ALL
SELECT 36,4,36 UNION ALL
SELECT 37,4,37 UNION ALL
SELECT 38,4,38 UNION ALL
SELECT 39,4,39 UNION ALL
SELECT 40,4,40 UNION ALL
SELECT 41,5,41 UNION ALL
SELECT 42,5,42 UNION ALL
SELECT 43,5,43 UNION ALL
SELECT 44,5,44 UNION ALL
SELECT 45,5,45 UNION ALL
SELECT 46,5,46 UNION ALL
SELECT 47,5,47 UNION ALL
SELECT 48,5,48 UNION ALL
SELECT 49,5,49 UNION ALL
SELECT 50,5,50 UNION ALL
SELECT 51,6,51 UNION ALL
SELECT 52,6,52 UNION ALL
SELECT 53,6,53 UNION ALL
SELECT 54,6,54 UNION ALL
SELECT 55,6,55 UNION ALL
SELECT 56,6,56 UNION ALL
SELECT 57,6,57 UNION ALL
SELECT 58,6,58 UNION ALL
SELECT 59,6,59 UNION ALL
SELECT 60,6,60 UNION ALL
SELECT 61,7,61 UNION ALL
SELECT 62,7,62 UNION ALL
SELECT 63,7,63 UNION ALL
SELECT 64,7,64 UNION ALL
SELECT 65,7,65 UNION ALL
SELECT 66,7,66 UNION ALL
SELECT 67,7,67 UNION ALL
SELECT 68,7,68 UNION ALL
SELECT 69,7,69 UNION ALL
SELECT 70,7,70 UNION ALL
SELECT 71,8,71 UNION ALL
SELECT 72,8,72 UNION ALL
SELECT 73,8,73 UNION ALL
SELECT 74,8,74 UNION ALL
SELECT 75,8,75 UNION ALL
SELECT 76,8,76 UNION ALL
SELECT 77,8,77 UNION ALL
SELECT 78,8,78 UNION ALL
SELECT 79,8,79 UNION ALL
SELECT 80,8,80 UNION ALL
SELECT 81,9,81 UNION ALL
SELECT 82,9,82 UNION ALL
SELECT 83,9,83 UNION ALL
SELECT 84,9,84 UNION ALL
SELECT 85,9,85 UNION ALL
SELECT 86,9,86 UNION ALL
SELECT 87,9,87 UNION ALL
SELECT 88,9,88 UNION ALL
SELECT 89,9,89 UNION ALL
SELECT 90,9,90 UNION ALL
SELECT 91,10,91 UNION ALL
SELECT 92,10,92 UNION ALL
SELECT 93,10,93 UNION ALL
SELECT 94,10,94 UNION ALL
SELECT 95,10,95 UNION ALL
SELECT 96,10,96 UNION ALL
SELECT 97,10,97 UNION ALL
SELECT 98,10,98 UNION ALL
SELECT 99,10,99 UNION ALL
SELECT 100,10,100

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

IF (OBJECT_ID(N'[SubEntitity]', N'U') IS NOT NULL)
	DROP TABLE [SubEntitity]

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

IF (OBJECT_ID(N'[SubEntitity]', N'U') IS NULL)
	CREATE TABLE [SubEntitity]
	(
		[Id]    Int NOT NULL,
		[Value] Int NOT NULL
	)

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

INSERT INTO [SubEntitity]
(
	[Id],
	[Value]
)
SELECT 1,20 UNION ALL
SELECT 2,40 UNION ALL
SELECT 3,60 UNION ALL
SELECT 4,80 UNION ALL
SELECT 5,100 UNION ALL
SELECT 6,120 UNION ALL
SELECT 7,140 UNION ALL
SELECT 8,160 UNION ALL
SELECT 9,180 UNION ALL
SELECT 10,200 UNION ALL
SELECT 11,220 UNION ALL
SELECT 12,240 UNION ALL
SELECT 13,260 UNION ALL
SELECT 14,280 UNION ALL
SELECT 15,300 UNION ALL
SELECT 16,320 UNION ALL
SELECT 17,340 UNION ALL
SELECT 18,360 UNION ALL
SELECT 19,380 UNION ALL
SELECT 20,400 UNION ALL
SELECT 21,420 UNION ALL
SELECT 22,440 UNION ALL
SELECT 23,460 UNION ALL
SELECT 24,480 UNION ALL
SELECT 25,500 UNION ALL
SELECT 26,520 UNION ALL
SELECT 27,540 UNION ALL
SELECT 28,560 UNION ALL
SELECT 29,580 UNION ALL
SELECT 30,600 UNION ALL
SELECT 31,620 UNION ALL
SELECT 32,640 UNION ALL
SELECT 33,660 UNION ALL
SELECT 34,680 UNION ALL
SELECT 35,700 UNION ALL
SELECT 36,720 UNION ALL
SELECT 37,740 UNION ALL
SELECT 38,760 UNION ALL
SELECT 39,780 UNION ALL
SELECT 40,800 UNION ALL
SELECT 41,820 UNION ALL
SELECT 42,840 UNION ALL
SELECT 43,860 UNION ALL
SELECT 44,880 UNION ALL
SELECT 45,900 UNION ALL
SELECT 46,920 UNION ALL
SELECT 47,940 UNION ALL
SELECT 48,960 UNION ALL
SELECT 49,980 UNION ALL
SELECT 50,1000 UNION ALL
SELECT 51,1020 UNION ALL
SELECT 52,1040 UNION ALL
SELECT 53,1060 UNION ALL
SELECT 54,1080 UNION ALL
SELECT 55,1100 UNION ALL
SELECT 56,1120 UNION ALL
SELECT 57,1140 UNION ALL
SELECT 58,1160 UNION ALL
SELECT 59,1180 UNION ALL
SELECT 60,1200 UNION ALL
SELECT 61,1220 UNION ALL
SELECT 62,1240 UNION ALL
SELECT 63,1260 UNION ALL
SELECT 64,1280 UNION ALL
SELECT 65,1300 UNION ALL
SELECT 66,1320 UNION ALL
SELECT 67,1340 UNION ALL
SELECT 68,1360 UNION ALL
SELECT 69,1380 UNION ALL
SELECT 70,1400 UNION ALL
SELECT 71,1420 UNION ALL
SELECT 72,1440 UNION ALL
SELECT 73,1460 UNION ALL
SELECT 74,1480 UNION ALL
SELECT 75,1500 UNION ALL
SELECT 76,1520 UNION ALL
SELECT 77,1540 UNION ALL
SELECT 78,1560 UNION ALL
SELECT 79,1580 UNION ALL
SELECT 80,1600 UNION ALL
SELECT 81,1620 UNION ALL
SELECT 82,1640 UNION ALL
SELECT 83,1660 UNION ALL
SELECT 84,1680 UNION ALL
SELECT 85,1700 UNION ALL
SELECT 86,1720 UNION ALL
SELECT 87,1740 UNION ALL
SELECT 88,1760 UNION ALL
SELECT 89,1780 UNION ALL
SELECT 90,1800 UNION ALL
SELECT 91,1820 UNION ALL
SELECT 92,1840 UNION ALL
SELECT 93,1860 UNION ALL
SELECT 94,1880 UNION ALL
SELECT 95,1900 UNION ALL
SELECT 96,1920 UNION ALL
SELECT 97,1940 UNION ALL
SELECT 98,1960 UNION ALL
SELECT 99,1980 UNION ALL
SELECT 100,2000

BeforeExecute
BeginTransaction(RepeatableRead)
BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

SELECT
	[m_1].[Id],
	[d_1].[Id],
	[d_1].[ParentId],
	[d_1].[SubId],
	[d_1].[cond],
	[d_1].[Value_1]
FROM
	(
		SELECT DISTINCT
			[t1].[Id]
		FROM
			[SampleClass1] [t1]
	) [m_1]
		CROSS APPLY (
			SELECT TOP (2)
				[a_SubItem].[Id] as [cond],
				[a_SubItem].[Value] as [Value_1],
				[d].[Id],
				[d].[ParentId],
				[d].[SubId]
			FROM
				[ChildEntitity] [d]
					LEFT JOIN [SubEntitity] [a_SubItem] ON [d].[SubId] = [a_SubItem].[Id]
			WHERE
				[m_1].[Id] = [d].[ParentId] AND
				[d].[ParentId] IS NOT NULL AND
				[d].[ParentId] % 3 = 0 AND
				[d].[ParentId] IS NOT NULL
			ORDER BY
				[d].[Id]
		) [d_1]

BeforeExecute
DisposeTransaction
BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

SELECT
	[t1].[Id],
	[t1].[Value]
FROM
	[SampleClass1] [t1]

BeforeExecute
BeginTransaction(RepeatableRead)
BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

SELECT
	[m_1].[Id],
	[d_1].[Id],
	[d_1].[ParentId],
	[d_1].[SubId],
	[d_1].[cond],
	[d_1].[Value_1]
FROM
	(
		SELECT DISTINCT
			[t1].[Id]
		FROM
			[SampleClass2] [t1]
	) [m_1]
		CROSS APPLY (
			SELECT TOP (2)
				[a_SubItem].[Id] as [cond],
				[a_SubItem].[Value] as [Value_1],
				[d].[Id],
				[d].[ParentId],
				[d].[SubId]
			FROM
				[ChildEntitity] [d]
					LEFT JOIN [SubEntitity] [a_SubItem] ON [d].[SubId] = [a_SubItem].[Id]
			WHERE
				[m_1].[Id] = [d].[ParentId] AND
				[d].[ParentId] IS NOT NULL AND
				[d].[ParentId] % 3 = 0 AND
				[d].[ParentId] IS NOT NULL
			ORDER BY
				[d].[Id]
		) [d_1]

BeforeExecute
DisposeTransaction
BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

SELECT
	[t1].[Id],
	[t1].[Value]
FROM
	[SampleClass2] [t1]

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

IF (OBJECT_ID(N'[SubEntitity]', N'U') IS NOT NULL)
	DROP TABLE [SubEntitity]

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

IF (OBJECT_ID(N'[ChildEntitity]', N'U') IS NOT NULL)
	DROP TABLE [ChildEntitity]

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

IF (OBJECT_ID(N'[SampleClass2]', N'U') IS NOT NULL)
	DROP TABLE [SampleClass2]

BeforeExecute
-- SqlServer.2005.MS SqlServer.2005

IF (OBJECT_ID(N'[SampleClass1]', N'U') IS NOT NULL)
	DROP TABLE [SampleClass1]

