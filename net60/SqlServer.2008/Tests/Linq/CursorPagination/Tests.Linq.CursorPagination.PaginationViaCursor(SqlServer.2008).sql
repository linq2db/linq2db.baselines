BeforeExecute
-- SqlServer.2008

IF (OBJECT_ID(N'[Booking]', N'U') IS NOT NULL)
	DROP TABLE [Booking]

BeforeExecute
-- SqlServer.2008

IF (OBJECT_ID(N'[Booking]', N'U') IS NULL)
	CREATE TABLE [Booking]
	(
		[BookingID]   Int      NOT NULL,
		[ServiceDate] DateTime NOT NULL,
		[Value]       Int      NOT NULL
	)

BeforeExecute
-- SqlServer.2008

INSERT INTO [Booking]
(
	[BookingID],
	[ServiceDate],
	[Value]
)
VALUES
(1,CAST('2020-02-27T17:54:55.123' AS DATETIME),1),
(2,CAST('2020-02-26T17:54:55.123' AS DATETIME),2),
(3,CAST('2020-02-28T17:54:55.123' AS DATETIME),3),
(4,CAST('2020-02-27T17:54:55.123' AS DATETIME),4),
(5,CAST('2020-02-26T17:54:55.123' AS DATETIME),5),
(6,CAST('2020-02-28T17:54:55.123' AS DATETIME),6),
(7,CAST('2020-02-27T17:54:55.123' AS DATETIME),7),
(8,CAST('2020-02-26T17:54:55.123' AS DATETIME),8),
(9,CAST('2020-02-28T17:54:55.123' AS DATETIME),9),
(10,CAST('2020-02-27T17:54:55.123' AS DATETIME),10),
(11,CAST('2020-02-26T17:54:55.123' AS DATETIME),11),
(12,CAST('2020-02-28T17:54:55.123' AS DATETIME),12),
(13,CAST('2020-02-27T17:54:55.123' AS DATETIME),13),
(14,CAST('2020-02-26T17:54:55.123' AS DATETIME),14),
(15,CAST('2020-02-28T17:54:55.123' AS DATETIME),15),
(16,CAST('2020-02-27T17:54:55.123' AS DATETIME),16),
(17,CAST('2020-02-26T17:54:55.123' AS DATETIME),17),
(18,CAST('2020-02-28T17:54:55.123' AS DATETIME),18),
(19,CAST('2020-02-27T17:54:55.123' AS DATETIME),19),
(20,CAST('2020-02-26T17:54:55.123' AS DATETIME),20),
(21,CAST('2020-02-28T17:54:55.123' AS DATETIME),21),
(22,CAST('2020-02-27T17:54:55.123' AS DATETIME),22),
(23,CAST('2020-02-26T17:54:55.123' AS DATETIME),23),
(24,CAST('2020-02-28T17:54:55.123' AS DATETIME),24),
(25,CAST('2020-02-27T17:54:55.123' AS DATETIME),25),
(26,CAST('2020-02-26T17:54:55.123' AS DATETIME),26),
(27,CAST('2020-02-28T17:54:55.123' AS DATETIME),27),
(28,CAST('2020-02-27T17:54:55.123' AS DATETIME),28),
(29,CAST('2020-02-26T17:54:55.123' AS DATETIME),29),
(30,CAST('2020-02-28T17:54:55.123' AS DATETIME),30),
(31,CAST('2020-02-27T17:54:55.123' AS DATETIME),31),
(32,CAST('2020-02-26T17:54:55.123' AS DATETIME),32),
(33,CAST('2020-02-28T17:54:55.123' AS DATETIME),33),
(34,CAST('2020-02-27T17:54:55.123' AS DATETIME),34),
(35,CAST('2020-02-26T17:54:55.123' AS DATETIME),35),
(36,CAST('2020-02-28T17:54:55.123' AS DATETIME),36),
(37,CAST('2020-02-27T17:54:55.123' AS DATETIME),37),
(38,CAST('2020-02-26T17:54:55.123' AS DATETIME),38),
(39,CAST('2020-02-28T17:54:55.123' AS DATETIME),39),
(40,CAST('2020-02-27T17:54:55.123' AS DATETIME),40),
(41,CAST('2020-02-26T17:54:55.123' AS DATETIME),41),
(42,CAST('2020-02-28T17:54:55.123' AS DATETIME),42),
(43,CAST('2020-02-27T17:54:55.123' AS DATETIME),43),
(44,CAST('2020-02-26T17:54:55.123' AS DATETIME),44),
(45,CAST('2020-02-28T17:54:55.123' AS DATETIME),45),
(46,CAST('2020-02-27T17:54:55.123' AS DATETIME),46),
(47,CAST('2020-02-26T17:54:55.123' AS DATETIME),47),
(48,CAST('2020-02-28T17:54:55.123' AS DATETIME),48),
(49,CAST('2020-02-27T17:54:55.123' AS DATETIME),49),
(50,CAST('2020-02-26T17:54:55.123' AS DATETIME),50),
(51,CAST('2020-02-28T17:54:55.123' AS DATETIME),51),
(52,CAST('2020-02-27T17:54:55.123' AS DATETIME),52),
(53,CAST('2020-02-26T17:54:55.123' AS DATETIME),53),
(54,CAST('2020-02-28T17:54:55.123' AS DATETIME),54),
(55,CAST('2020-02-27T17:54:55.123' AS DATETIME),55),
(56,CAST('2020-02-26T17:54:55.123' AS DATETIME),56),
(57,CAST('2020-02-28T17:54:55.123' AS DATETIME),57),
(58,CAST('2020-02-27T17:54:55.123' AS DATETIME),58),
(59,CAST('2020-02-26T17:54:55.123' AS DATETIME),59),
(60,CAST('2020-02-28T17:54:55.123' AS DATETIME),60),
(61,CAST('2020-02-27T17:54:55.123' AS DATETIME),61),
(62,CAST('2020-02-26T17:54:55.123' AS DATETIME),62),
(63,CAST('2020-02-28T17:54:55.123' AS DATETIME),63),
(64,CAST('2020-02-27T17:54:55.123' AS DATETIME),64),
(65,CAST('2020-02-26T17:54:55.123' AS DATETIME),65),
(66,CAST('2020-02-28T17:54:55.123' AS DATETIME),66),
(67,CAST('2020-02-27T17:54:55.123' AS DATETIME),67),
(68,CAST('2020-02-26T17:54:55.123' AS DATETIME),68),
(69,CAST('2020-02-28T17:54:55.123' AS DATETIME),69),
(70,CAST('2020-02-27T17:54:55.123' AS DATETIME),70),
(71,CAST('2020-02-26T17:54:55.123' AS DATETIME),71),
(72,CAST('2020-02-28T17:54:55.123' AS DATETIME),72),
(73,CAST('2020-02-27T17:54:55.123' AS DATETIME),73),
(74,CAST('2020-02-26T17:54:55.123' AS DATETIME),74),
(75,CAST('2020-02-28T17:54:55.123' AS DATETIME),75),
(76,CAST('2020-02-27T17:54:55.123' AS DATETIME),76),
(77,CAST('2020-02-26T17:54:55.123' AS DATETIME),77),
(78,CAST('2020-02-28T17:54:55.123' AS DATETIME),78),
(79,CAST('2020-02-27T17:54:55.123' AS DATETIME),79),
(80,CAST('2020-02-26T17:54:55.123' AS DATETIME),80),
(81,CAST('2020-02-28T17:54:55.123' AS DATETIME),81),
(82,CAST('2020-02-27T17:54:55.123' AS DATETIME),82),
(83,CAST('2020-02-26T17:54:55.123' AS DATETIME),83),
(84,CAST('2020-02-28T17:54:55.123' AS DATETIME),84),
(85,CAST('2020-02-27T17:54:55.123' AS DATETIME),85),
(86,CAST('2020-02-26T17:54:55.123' AS DATETIME),86),
(87,CAST('2020-02-28T17:54:55.123' AS DATETIME),87),
(88,CAST('2020-02-27T17:54:55.123' AS DATETIME),88),
(89,CAST('2020-02-26T17:54:55.123' AS DATETIME),89),
(90,CAST('2020-02-28T17:54:55.123' AS DATETIME),90),
(91,CAST('2020-02-27T17:54:55.123' AS DATETIME),91),
(92,CAST('2020-02-26T17:54:55.123' AS DATETIME),92),
(93,CAST('2020-02-28T17:54:55.123' AS DATETIME),93),
(94,CAST('2020-02-27T17:54:55.123' AS DATETIME),94),
(95,CAST('2020-02-26T17:54:55.123' AS DATETIME),95),
(96,CAST('2020-02-28T17:54:55.123' AS DATETIME),96),
(97,CAST('2020-02-27T17:54:55.123' AS DATETIME),97),
(98,CAST('2020-02-26T17:54:55.123' AS DATETIME),98),
(99,CAST('2020-02-28T17:54:55.123' AS DATETIME),99),
(100,CAST('2020-02-27T17:54:55.123' AS DATETIME),100)

BeforeExecute
-- SqlServer.2008
DECLARE @ServiceDate DateTime2
SET     @ServiceDate = CAST('2020-02-27T17:54:55.1231234' AS DATETIME2)

SELECT
	[t].[BookingID],
	[t].[ServiceDate],
	[t].[Value]
FROM
	[Booking] [t]
WHERE
	[t].[ServiceDate] > @ServiceDate
ORDER BY
	[t].[ServiceDate] DESC,
	[t].[BookingID] DESC

BeforeExecute
-- SqlServer.2008
DECLARE @ServiceDate DateTime2
SET     @ServiceDate = CAST('2020-02-27T17:54:55.1231234' AS DATETIME2)
DECLARE @take BigInt -- Int64
SET     @take = 12

SELECT
	[q].[c1],
	[q].[RowNumber],
	[q].[BookingID],
	[q].[ServiceDate],
	[q].[Value_1]
FROM
	(
		SELECT
			ROW_NUMBER() OVER(ORDER BY [t].[ServiceDate] DESC, [t].[BookingID] DESC) as [RowNumber],
			COUNT(*) OVER() as [c1],
			[t].[BookingID],
			[t].[ServiceDate],
			[t].[Value] as [Value_1]
		FROM
			[Booking] [t]
		WHERE
			[t].[ServiceDate] > @ServiceDate
	) [q]
WHERE
	[q].[RowNumber] <= @take

BeforeExecute
-- SqlServer.2008
DECLARE @ServiceDate DateTime2
SET     @ServiceDate = CAST('2020-02-27T17:54:55.1231234' AS DATETIME2)
DECLARE @cursorValue Int -- Int32
SET     @cursorValue = 66
DECLARE @take BigInt -- Int64
SET     @take = 12

WITH [CTE_1]
(
	[Cursor],
	[RowNumber],
	[ServiceDate],
	[Value]
)
AS
(
	SELECT
		[t].[BookingID],
		ROW_NUMBER() OVER(ORDER BY [t].[ServiceDate] DESC, [t].[BookingID] DESC),
		[t].[ServiceDate],
		[t].[Value]
	FROM
		[Booking] [t]
	WHERE
		[t].[ServiceDate] > @ServiceDate
)
SELECT
	[q].[RowNumber],
	[q].[Cursor],
	[q].[ServiceDate],
	[q].[Value]
FROM
	[CTE_1] [q]
WHERE
	EXISTS(
		SELECT
			*
		FROM
			[CTE_1] [c_1]
		WHERE
			[c_1].[Cursor] = @cursorValue AND [q].[RowNumber] > [c_1].[RowNumber] AND
			[q].[RowNumber] <= [c_1].[RowNumber] + @take
	)

BeforeExecute
-- SqlServer.2008
DECLARE @ServiceDate DateTime2
SET     @ServiceDate = CAST('2020-02-27T17:54:55.1231234' AS DATETIME2)
DECLARE @cursorValue Int -- Int32
SET     @cursorValue = 30
DECLARE @take BigInt -- Int64
SET     @take = 12

WITH [CTE_1]
(
	[Cursor],
	[RowNumber],
	[ServiceDate],
	[Value]
)
AS
(
	SELECT
		[t].[BookingID],
		ROW_NUMBER() OVER(ORDER BY [t].[ServiceDate] DESC, [t].[BookingID] DESC),
		[t].[ServiceDate],
		[t].[Value]
	FROM
		[Booking] [t]
	WHERE
		[t].[ServiceDate] > @ServiceDate
)
SELECT
	[q].[RowNumber],
	[q].[Cursor],
	[q].[ServiceDate],
	[q].[Value]
FROM
	[CTE_1] [q]
WHERE
	EXISTS(
		SELECT
			*
		FROM
			[CTE_1] [c_1]
		WHERE
			[c_1].[Cursor] = @cursorValue AND [q].[RowNumber] > [c_1].[RowNumber] AND
			[q].[RowNumber] <= [c_1].[RowNumber] + @take
	)

BeforeExecute
-- SqlServer.2008
DECLARE @ServiceDate DateTime2
SET     @ServiceDate = CAST('2020-02-27T17:54:55.1231234' AS DATETIME2)
DECLARE @cursorValue Int -- Int32
SET     @cursorValue = 3
DECLARE @take BigInt -- Int64
SET     @take = 12

WITH [CTE_1]
(
	[Cursor],
	[RowNumber],
	[ServiceDate],
	[Value]
)
AS
(
	SELECT
		[t].[BookingID],
		ROW_NUMBER() OVER(ORDER BY [t].[ServiceDate] DESC, [t].[BookingID] DESC),
		[t].[ServiceDate],
		[t].[Value]
	FROM
		[Booking] [t]
	WHERE
		[t].[ServiceDate] > @ServiceDate
)
SELECT
	[q].[RowNumber],
	[q].[Cursor],
	[q].[ServiceDate],
	[q].[Value]
FROM
	[CTE_1] [q]
WHERE
	EXISTS(
		SELECT
			*
		FROM
			[CTE_1] [c_1]
		WHERE
			[c_1].[Cursor] = @cursorValue AND [q].[RowNumber] > [c_1].[RowNumber] AND
			[q].[RowNumber] <= [c_1].[RowNumber] + @take
	)

BeforeExecute
-- SqlServer.2008

IF (OBJECT_ID(N'[Booking]', N'U') IS NOT NULL)
	DROP TABLE [Booking]

