BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL

CREATE TABLE billing_devtypes
(
	devtypeid    SERIAL  NOT NULL,
	"GlobalType" Int     NOT NULL,
	typename     text    NOT NULL,

	CONSTRAINT "PK_billing_devtypes" PRIMARY KEY (devtypeid)
)

BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL

CREATE TABLE billing_devices
(
	devid     text NOT NULL,
	devtypeid Int  NOT NULL,
	sernum    text     NULL,

	CONSTRAINT "PK_billing_devices" PRIMARY KEY (devid)
)

BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL

CREATE TABLE "billing_DevReadingType"
(
	"DevTypeId"      Int     NOT NULL,
	"Id"             SERIAL  NOT NULL,
	"Name"           text    NOT NULL,
	"Responsibility" Int     NOT NULL,

	CONSTRAINT "PK_billing_DevReadingType" PRIMARY KEY ("Id")
)

BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL

CREATE TABLE "billing_TempReading"
(
	"DevGlobalType"    Int        NOT NULL,
	"DevReadingTypeId" Int            NULL,
	"DevSerNum"        text       NOT NULL,
	devid              text           NULL,
	"Devtypeid"        Int            NULL,
	id                 SERIAL     NOT NULL,
	"ReadingTypeName"  text           NULL,
	"Responsibility"   Int        NOT NULL,
	tsdevice           TimeStamp  NOT NULL,
	value              Decimal    NOT NULL,

	CONSTRAINT "PK_billing_TempReading" PRIMARY KEY (id)
)

BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL

UPDATE
	"billing_TempReading"
SET
	"DevReadingTypeId" = drt."Id",
	"Responsibility" = drt."Responsibility"
FROM
	"billing_DevReadingType" drt
WHERE
	drt."Name" = "billing_TempReading"."ReadingTypeName" AND
	drt."DevTypeId" = "billing_TempReading"."Devtypeid"

BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL
DECLARE @take Integer -- Int32
SET     @take = 1
DECLARE @take_1 Integer -- Int32
SET     @take_1 = 1

UPDATE
	"billing_TempReading"
SET
	"DevReadingTypeId" = (
		SELECT
			w."Id"
		FROM
			"billing_DevReadingType" w
		WHERE
			w."Name" = "billing_TempReading"."ReadingTypeName" AND
			w."DevTypeId" = "billing_TempReading"."Devtypeid"
		LIMIT :take
	),
	"Responsibility" = (
		SELECT
			w_1."Responsibility"
		FROM
			"billing_DevReadingType" w_1
		WHERE
			w_1."Name" = "billing_TempReading"."ReadingTypeName" AND
			w_1."DevTypeId" = "billing_TempReading"."Devtypeid"
		LIMIT :take_1
	)

BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL

DROP TABLE "billing_TempReading"

BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL

DROP TABLE "billing_DevReadingType"

BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL

DROP TABLE billing_devices

BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL

DROP TABLE billing_devtypes

