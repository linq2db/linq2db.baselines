BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL

CREATE TABLE "Issue1564Category"
(
	"DisplayOrder" Int     NOT NULL,
	"Id"           Int     NOT NULL,
	"IsVisible"    Boolean NOT NULL,
	"Name"         text        NULL,
	"ParentId"     Int     NOT NULL,

	CONSTRAINT "PK_Issue1564Category" PRIMARY KEY ("Id")
)

BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL

WITH RECURSIVE "categoryHierarchy"
(
	"CategoryId",
	"Level",
	"Name",
	"ParentCategoryId",
	"RootCategoryId"
)
AS
(
	SELECT
		"innerC"."Id",
		0,
		"innerC"."Name",
		"innerC"."ParentId",
		"innerC"."Id"
	FROM
		"Issue1564Category" "innerC"
	UNION ALL
	SELECT
		c_1."Id",
		ch."Level" + 1,
		c_1."Name",
		c_1."ParentId",
		ch."RootCategoryId"
	FROM
		"Issue1564Category" c_1
			INNER JOIN "categoryHierarchy" ch ON ch."ParentCategoryId" = c_1."Id"
)
SELECT
	t1."CategoryId",
	t1."Level",
	t1."Name",
	t1."ParentCategoryId",
	t1."RootCategoryId"
FROM
	"categoryHierarchy" t1

BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL

WITH RECURSIVE "categoryHierarchy"
(
	"CategoryId",
	"Level",
	"Name",
	"ParentCategoryId",
	"RootCategoryId"
)
AS
(
	SELECT
		"innerC"."Id",
		0,
		"innerC"."Name",
		"innerC"."ParentId",
		"innerC"."Id"
	FROM
		"Issue1564Category" "innerC"
	UNION ALL
	SELECT
		c_1."Id",
		ch."Level" + 1,
		c_1."Name",
		c_1."ParentId",
		ch."RootCategoryId"
	FROM
		"Issue1564Category" c_1
			INNER JOIN "categoryHierarchy" ch ON ch."ParentCategoryId" = c_1."Id"
)
SELECT
	c_2."Id",
	c_2."IsVisible",
	c_2."DisplayOrder",
	(
		SELECT
			STRING_AGG(c1."Name", ' -> ' ORDER BY c1."Level" DESC)
		FROM
			"categoryHierarchy" c1
		WHERE
			c1."RootCategoryId" = c_2."Id"
	)
FROM
	"Issue1564Category" c_2

BeforeExecute
-- PostgreSQL PostgreSQL.9.5 PostgreSQL

DROP TABLE "Issue1564Category"

