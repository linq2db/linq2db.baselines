BeforeExecute
-- SqlServer.2008

IF (OBJECT_ID(N'[Booking]', N'U') IS NOT NULL)
	DROP TABLE [Booking]

BeforeExecute
-- SqlServer.2008

IF (OBJECT_ID(N'[Booking]', N'U') IS NULL)
	CREATE TABLE [Booking]
	(
		[BookingID]   Int       NOT NULL,
		[ServiceDate] DateTime2 NOT NULL,
		[Value]       Int       NOT NULL
	)

BeforeExecute
-- SqlServer.2008

INSERT INTO [Booking]
(
	[BookingID],
	[ServiceDate],
	[Value]
)
VALUES
(1,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),1),
(2,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),2),
(3,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),3),
(4,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),4),
(5,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),5),
(6,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),6),
(7,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),7),
(8,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),8),
(9,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),9),
(10,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),10),
(11,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),11),
(12,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),12),
(13,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),13),
(14,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),14),
(15,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),15),
(16,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),16),
(17,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),17),
(18,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),18),
(19,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),19),
(20,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),20),
(21,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),21),
(22,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),22),
(23,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),23),
(24,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),24),
(25,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),25),
(26,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),26),
(27,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),27),
(28,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),28),
(29,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),29),
(30,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),30),
(31,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),31),
(32,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),32),
(33,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),33),
(34,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),34),
(35,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),35),
(36,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),36),
(37,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),37),
(38,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),38),
(39,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),39),
(40,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),40),
(41,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),41),
(42,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),42),
(43,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),43),
(44,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),44),
(45,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),45),
(46,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),46),
(47,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),47),
(48,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),48),
(49,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),49),
(50,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),50),
(51,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),51),
(52,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),52),
(53,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),53),
(54,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),54),
(55,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),55),
(56,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),56),
(57,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),57),
(58,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),58),
(59,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),59),
(60,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),60),
(61,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),61),
(62,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),62),
(63,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),63),
(64,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),64),
(65,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),65),
(66,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),66),
(67,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),67),
(68,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),68),
(69,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),69),
(70,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),70),
(71,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),71),
(72,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),72),
(73,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),73),
(74,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),74),
(75,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),75),
(76,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),76),
(77,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),77),
(78,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),78),
(79,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),79),
(80,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),80),
(81,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),81),
(82,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),82),
(83,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),83),
(84,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),84),
(85,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),85),
(86,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),86),
(87,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),87),
(88,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),88),
(89,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),89),
(90,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),90),
(91,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),91),
(92,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),92),
(93,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),93),
(94,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),94),
(95,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),95),
(96,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),96),
(97,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),97),
(98,CAST('2020-02-26T17:54:55.1231234' AS DATETIME2),98),
(99,CAST('2020-02-28T17:54:55.1231234' AS DATETIME2),99),
(100,CAST('2020-02-27T17:54:55.1231234' AS DATETIME2),100)

BeforeExecute
-- SqlServer.2008
DECLARE @DateTime DateTime2
SET     @DateTime = CAST('2020-02-29T17:54:55.1231234' AS DATETIME2)

SELECT
	[t].[BookingID],
	[t].[ServiceDate],
	[t].[Value]
FROM
	[Booking] [t]
WHERE
	[t].[ServiceDate] > DateAdd(day, -2, @DateTime)
ORDER BY
	[t].[ServiceDate] DESC,
	[t].[BookingID] DESC

BeforeExecute
-- SqlServer.2008
DECLARE @DateTime DateTime2
SET     @DateTime = CAST('2020-02-29T17:54:55.1231234' AS DATETIME2)
DECLARE @take BigInt -- Int64
SET     @take = 12

SELECT
	[q].[TotalCount],
	[q].[RowNumber],
	[q].[BookingID],
	[q].[ServiceDate],
	[q].[Value_1]
FROM
	(
		SELECT
			ROW_NUMBER() OVER(ORDER BY [t].[ServiceDate] DESC, [t].[BookingID] DESC) as [RowNumber],
			COUNT(*) OVER() as [TotalCount],
			[t].[BookingID],
			[t].[ServiceDate],
			[t].[Value] as [Value_1]
		FROM
			[Booking] [t]
		WHERE
			[t].[ServiceDate] > DateAdd(day, -2, @DateTime)
	) [q]
WHERE
	[q].[RowNumber] <= @take

BeforeExecute
-- SqlServer.2008
DECLARE @DateTime DateTime2
SET     @DateTime = CAST('2020-02-29T17:54:55.1231234' AS DATETIME2)
DECLARE @cursorValue Int -- Int32
SET     @cursorValue = 66
DECLARE @take Int -- Int32
SET     @take = 12

WITH [CTE_1]
(
	[Cursor_1],
	[RowNumber],
	[Data_BookingID],
	[Data_ServiceDate],
	[Data_Value]
)
AS
(
	SELECT
		[t].[BookingID],
		ROW_NUMBER() OVER(ORDER BY [t].[ServiceDate] DESC, [t].[BookingID] DESC),
		[t].[BookingID],
		[t].[ServiceDate],
		[t].[Value]
	FROM
		[Booking] [t]
	WHERE
		[t].[ServiceDate] > DateAdd(day, -2, @DateTime)
)
SELECT
	[q].[RowNumber],
	[q].[Cursor_1],
	[q].[Data_BookingID],
	[q].[Data_ServiceDate],
	[q].[Data_Value]
FROM
	[CTE_1] [q]
WHERE
	EXISTS(
		SELECT
			*
		FROM
			[CTE_1] [c_1]
		WHERE
			[c_1].[Cursor_1] = @cursorValue AND [q].[RowNumber] > [c_1].[RowNumber] AND
			[q].[RowNumber] <= [c_1].[RowNumber] + @take
	)

BeforeExecute
-- SqlServer.2008
DECLARE @DateTime DateTime2
SET     @DateTime = CAST('2020-02-29T17:54:55.1231234' AS DATETIME2)
DECLARE @cursorValue Int -- Int32
SET     @cursorValue = 30
DECLARE @take Int -- Int32
SET     @take = 12

WITH [CTE_1]
(
	[Cursor_1],
	[RowNumber],
	[Data_BookingID],
	[Data_ServiceDate],
	[Data_Value]
)
AS
(
	SELECT
		[t].[BookingID],
		ROW_NUMBER() OVER(ORDER BY [t].[ServiceDate] DESC, [t].[BookingID] DESC),
		[t].[BookingID],
		[t].[ServiceDate],
		[t].[Value]
	FROM
		[Booking] [t]
	WHERE
		[t].[ServiceDate] > DateAdd(day, -2, @DateTime)
)
SELECT
	[q].[RowNumber],
	[q].[Cursor_1],
	[q].[Data_BookingID],
	[q].[Data_ServiceDate],
	[q].[Data_Value]
FROM
	[CTE_1] [q]
WHERE
	EXISTS(
		SELECT
			*
		FROM
			[CTE_1] [c_1]
		WHERE
			[c_1].[Cursor_1] = @cursorValue AND [q].[RowNumber] > [c_1].[RowNumber] AND
			[q].[RowNumber] <= [c_1].[RowNumber] + @take
	)

BeforeExecute
-- SqlServer.2008
DECLARE @DateTime DateTime2
SET     @DateTime = CAST('2020-02-29T17:54:55.1231234' AS DATETIME2)
DECLARE @cursorValue Int -- Int32
SET     @cursorValue = 3
DECLARE @take Int -- Int32
SET     @take = 12

WITH [CTE_1]
(
	[Cursor_1],
	[RowNumber],
	[Data_BookingID],
	[Data_ServiceDate],
	[Data_Value]
)
AS
(
	SELECT
		[t].[BookingID],
		ROW_NUMBER() OVER(ORDER BY [t].[ServiceDate] DESC, [t].[BookingID] DESC),
		[t].[BookingID],
		[t].[ServiceDate],
		[t].[Value]
	FROM
		[Booking] [t]
	WHERE
		[t].[ServiceDate] > DateAdd(day, -2, @DateTime)
)
SELECT
	[q].[RowNumber],
	[q].[Cursor_1],
	[q].[Data_BookingID],
	[q].[Data_ServiceDate],
	[q].[Data_Value]
FROM
	[CTE_1] [q]
WHERE
	EXISTS(
		SELECT
			*
		FROM
			[CTE_1] [c_1]
		WHERE
			[c_1].[Cursor_1] = @cursorValue AND [q].[RowNumber] > [c_1].[RowNumber] AND
			[q].[RowNumber] <= [c_1].[RowNumber] + @take
	)

BeforeExecute
-- SqlServer.2008

IF (OBJECT_ID(N'[Booking]', N'U') IS NOT NULL)
	DROP TABLE [Booking]

