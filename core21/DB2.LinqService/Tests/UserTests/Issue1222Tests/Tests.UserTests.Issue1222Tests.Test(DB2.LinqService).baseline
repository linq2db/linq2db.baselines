BeforeExecute
-- DB2 DB2.LUW DB2LUW

CREATE TABLE "stLinks"
(
	"dtModified"    timestamp                                  NOT NULL,
	"dtSynchDate"   timestamp                                      NULL,
	"inId"          Int           GENERATED ALWAYS AS IDENTITY NOT NULL,
	"inIdChild"     Int                                        NOT NULL,
	"inIdMeasure"   Int                                            NULL,
	"inIdOrgOwner"  Int                                            NULL,
	"inIdParent"    Int                                        NOT NULL,
	"inIdTypeRel"   Int                                        NOT NULL,
	"inIdUnit"      Int                                            NULL,
	"inMaxQuantity" Float                                          NULL,
	"inMinQuantity" Float                                          NULL,
	"stGUID"        NVarChar(255)                              NOT NULL,
	"State"         Int                                            NULL,

	CONSTRAINT "PK_stLinks" PRIMARY KEY ("inId")
)

BeforeExecute
-- DB2 DB2.LUW DB2LUW

CREATE TABLE "stVersions"
(
	"inId"     Int GENERATED ALWAYS AS IDENTITY NOT NULL,
	"inIdMain" Int                              NOT NULL,

	CONSTRAINT "PK_stVersions" PRIMARY KEY ("inId")
)

BeforeExecute
-- DB2 DB2.LUW DB2LUW
DECLARE @parentId Integer(4) -- Int32
SET     @parentId = 111

SELECT
	"version_1"."inIdMain"
FROM
	(
		SELECT
			"link_1"."inIdChild" as "Link_1",
			"link_1"."dtModified" as "Link_2",
			"link_1"."dtSynchDate" as "Link_3",
			"link_1"."inId" as "Link_4",
			"link_1"."inIdChild" as "Link_5",
			"link_1"."inIdMeasure" as "Link_6",
			"link_1"."inIdOrgOwner" as "Link_7",
			"link_1"."inIdParent" as "Link_8",
			"link_1"."inIdTypeRel" as "Link_9",
			"link_1"."inIdUnit" as "Link_10",
			"link_1"."inMaxQuantity" as "Link_11",
			"link_1"."inMinQuantity" as "Link_12",
			"link_1"."stGUID" as "Link_13",
			"link_1"."State" as "Link_14"
		FROM
			"stLinks" "link_1"
		WHERE
			"link_1"."inIdParent" = @parentId
		UNION ALL
		SELECT
			"link_2"."inIdParent" as "Link_1",
			"link_2"."dtModified" as "Link_2",
			"link_2"."dtSynchDate" as "Link_3",
			"link_2"."inId" as "Link_4",
			"link_2"."inIdChild" as "Link_5",
			"link_2"."inIdMeasure" as "Link_6",
			"link_2"."inIdOrgOwner" as "Link_7",
			"link_2"."inIdParent" as "Link_8",
			"link_2"."inIdTypeRel" as "Link_9",
			"link_2"."inIdUnit" as "Link_10",
			"link_2"."inMaxQuantity" as "Link_11",
			"link_2"."inMinQuantity" as "Link_12",
			"link_2"."stGUID" as "Link_13",
			"link_2"."State" as "Link_14"
		FROM
			"stLinks" "link_2"
		WHERE
			"link_2"."inIdChild" = @parentId
	) "u"
		INNER JOIN "stVersions" "version_1" ON "u"."Link_1" = "version_1"."inId"

BeforeExecute
-- DB2 DB2.LUW DB2LUW

DROP TABLE "stVersions"

BeforeExecute
-- DB2 DB2.LUW DB2LUW

DROP TABLE "stLinks"

